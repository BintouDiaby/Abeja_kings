{% extends 'core/base.html' %}
{% block title %}{% if personnel %}Modifier{% else %}Nouveau{% endif %} personnel{% endblock %}
{% block content %}
<form method="post">
  {% csrf_token %}

  {% if not personnel %}
  <div class="form-group">
    <label for="user">Utilisateur *</label>
    <select id="user" name="user" required>
      <option value="">Sélectionner un utilisateur</option>
      {% for user in available_users %}
        <option value="{{ user.id }}">{{ user.get_full_name }} ({{ user.username }})</option>
      {% endfor %}
    </select>
  </div>
  {% endif %}

  <div class="form-group">
    <label for="role">Rôle *</label>
    <select id="role" name="role" required>
      <option value="ouvrier" {% if personnel and personnel.role == 'ouvrier' %}selected{% endif %}>Ouvrier</option>
      <option value="maitre_ouvrier" {% if personnel and personnel.role == 'maitre_ouvrier' %}selected{% endif %}>Maître Ouvrier</option>
      <option value="chef_chantier" {% if personnel and personnel.role == 'chef_chantier' %}selected{% endif %}>Chef de Chantier</option>
      <option value="apprenti" {% if personnel and personnel.role == 'apprenti' %}selected{% endif %}>Apprenti</option>
    </select>
  </div>

  <div class="form-row">
    <div class="form-group">
      <label for="taux_horaire">Taux horaire (FCFA) *</label>
      <input type="number" id="taux_horaire" name="taux_horaire" step="0.01" value="{{ personnel.taux_horaire|default:'' }}" required>
    </div>
    <div class="form-group">
      <label for="date_embauche">Date d'embauche *</label>
      <input type="date" id="date_embauche" name="date_embauche" value="{{ personnel.date_embauche|date:'Y-m-d'|default:'' }}" required>
    </div>
  </div>

  <div class="form-row">
    <div class="form-group">
      <label for="telephone">Téléphone</label>
      <input type="tel" id="telephone" name="telephone" value="{{ personnel.telephone|default:'' }}">
    </div>
    <div class="form-group">
      <label for="chantier_actuel">Chantier actuel</label>
      <select id="chantier_actuel" name="chantier_actuel">
        <option value="">Aucun chantier</option>
        {% for chantier in chantiers %}
          <option value="{{ chantier.id }}" {% if personnel and personnel.chantier_actuel and personnel.chantier_actuel.id == chantier.id %}selected{% endif %}>{{ chantier.nom }}</option>
        {% endfor %}
      </select>
    </div>
  </div>

  <div class="form-group">
    <label for="adresse">Adresse</label>
    <textarea id="adresse" name="adresse" rows="2">{{ personnel.adresse|default:'' }}</textarea>
  </div>

  <div class="form-group">
    <label class="checkbox-label">
      <input type="checkbox" id="est_actif" name="est_actif" {% if personnel and personnel.est_actif %}checked{% elif not personnel %}checked{% endif %}>
      Personnel actif
    </label>
  </div>

  <div class="form-actions">
    <button class="primary" type="submit">Enregistrer</button>
    <a href="{% url 'core:personnel' %}" class="secondary">Annuler</a>
  </div>
</form>
{% endblock %}