{% extends "core/base.html" %}
{% load static %}

{% block extrastyle %}
        <style>
:root{
  --bg:#f6f8fb;
  --card:#ffffff;
  --muted:#6b7280;
  --accent-1: #5b6ff0;
  --accent-2: #8b5cf6;
  --success: #16a34a;
  --warning: #f59e0b;
  --danger: #ef4444;

}

/* Global layout */
.dashboard-container{
    padding:28px;
    max-width:1320px; /* corrected width */
    margin:0 auto;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
}

@keyframes fadeIn{from{opacity:0; transform:translateY(8px)}to{opacity:1; transform:none}}
.dashboard-container{animation:fadeIn .45s ease both}

/* Header */
    .dashboard-header{
    background: linear-gradient(90deg, rgba(91,111,240,0.10), rgba(139,92,246,0.06));
    color:#0f172a;
    padding:10px 14px; /* reduced padding for tighter header */
    border-radius:12px;
    margin-bottom:22px;
    box-shadow: 0 6px 18px rgba(20,25,55,0.06);
    display:flex;
    align-items:center;
    gap:12px;
    position:relative; z-index:2;
}
    .header-meta{display:flex;align-items:center;gap:8px}
    .header-meta .small{margin:0;color:var(--muted);font-size:0.95rem}
    /* Layout slots used in template */
    .header-left{display:flex;align-items:center;gap:12px}
    .header-center{flex:1;display:flex;align-items:center}
    .header-right{display:flex;align-items:center;gap:12px}
    /* Hide the global base h1 for this page (we render title inside dashboard header) */
    main.container > h1{display:none}
    .page-title{font-size:1.25rem;margin:0;font-weight:800;color:#0b1220}
/* Header actions: spacing and button styles */
    .header-content{display:flex; align-items:center; gap:18px; flex:1}
    .header-content h1{font-size:1.7rem; margin:0; font-weight:800; letter-spacing: -0.3px; color: #0b1220}

/* Header actions: spacing and button styles */
    .header-actions{display:flex; align-items:center; gap:12px; margin-left:auto}
    .header-actions form{margin:0}
    .header-actions .btn{padding:8px 12px; border-radius:8px; font-weight:600}
    /* smaller square primary button used in header */
    .header-btn{padding:8px; width:44px; height:44px; display:inline-flex; align-items:center; justify-content:center; border-radius:10px}
    .header-btn i{font-size:1.15rem}
    .header-actions .btn.btn-primary{background:var(--accent-1); color:#fff; border:none}
    .header-actions .btn.btn-outline{background: transparent; border:1px solid rgba(15,23,42,0.06); color:var(--muted)}
    .header-actions .btn.btn-outline:hover{background:rgba(15,23,42,0.02)}
    .header-actions .logout-spacer{margin-left:20px}

    /* Slightly larger icon and clearer stat fonts */
    .dashboard-header h1 i{margin-right:8px; color:var(--accent-1); font-size:1.15em}
    .stat-content h3{font-size:1.6rem}
    .stat-content p{font-size:0.95rem}

/* Stats grid */
.stats-grid{display:grid; grid-template-columns: repeat(3, 1fr); gap:22px; margin-bottom:42px}
.stat-card{
  background:var(--card);
  border-radius:14px;
  padding:18px;
  display:flex; align-items:center; gap:18px;
  box-shadow: 0 6px 18px rgba(20,25,55,0.06);
  transition: transform .22s cubic-bezier(.2,.9,.3,1), box-shadow .22s;
  position:relative; overflow:hidden; border:1px solid rgba(16,24,40,0.03)
}
.stat-card:hover{transform:translateY(-6px); box-shadow: 0 14px 40px rgba(20,25,55,0.09)}

/* Icon */
.stat-icon{
    width:74px;
    height:74px;
    border-radius:18px;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:26px;
    color:var(--muted);
    background:linear-gradient(180deg,#ffffff,#f6f9ff);
    border-left:6px solid rgba(91,111,240,0.10);
    box-shadow: 0 10px 30px rgba(16,24,40,0.06), inset 0 1px 0 rgba(255,255,255,0.6);
    position:relative;
    overflow:visible;
}
.stat-icon::before{
    content:'';
    position:absolute;
    right:-28px;
    bottom:-28px;
    width:92px;
    height:92px;
    border-radius:50%;
    background: radial-gradient(circle at 30% 30%, rgba(99,102,241,0.06), transparent 40%);
    filter:blur(6px);
    pointer-events:none;
    z-index:0;
}
.stat-icon i{font-size:24px;color:inherit;z-index:2}
.stat-svg{width:26px;height:26px;display:block}
.stat-svg path,.stat-svg rect,.stat-svg circle{fill:currentColor}
.stat-icon.active{color:#fff; border-left-color: rgba(16,185,129,0.95); background:linear-gradient(180deg,#10b981,#34d399)}
.stat-icon.completed{color:#fff; border-left-color: rgba(37,99,235,0.95); background:linear-gradient(180deg,#2563eb,#3b82f6)}
.stat-icon.money{color:#fff; border-left-color: rgba(217,119,6,0.95); background:linear-gradient(180deg,#d97706,#f59e0b)}
.stat-icon:hover{transform:translateY(-4px);transition:transform .18s}

.stat-content h3{font-size:1.7rem;margin:0;color:#0f172a;font-weight:700}
.stat-content p{margin:2px 0 0;color:var(--muted);font-size:0.95rem}
.warning{color:var(--danger); font-weight:700}

/* Decorative halo */
.stat-card::after{content:'';position:absolute;right:-40px;bottom:-40px;width:140px;height:140px;border-radius:50%;background:linear-gradient(135deg, rgba(99,102,241,0.08), rgba(139,92,246,0.06));filter:blur(6px);transform:scale(.95);transition:transform .3s}
.stat-card:hover::after{transform:scale(1.25)}

/* Content grid */
.content-grid{display:grid; grid-template-columns: 1fr 1fr; gap:28px}
.content-card{background:var(--card); border-radius:12px; overflow:hidden; box-shadow: 0 8px 30px rgba(15,23,42,0.04); border:1px solid rgba(15,23,42,0.02)}
.card-header{padding:18px 20px;background:linear-gradient(180deg, rgba(245,247,250,0.6), rgba(249,250,251,0.6)); display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid rgba(15,23,42,0.03)}
.card-header h2{font-size:1.05rem;margin:0;color:#111;font-weight:700}
.btn-link{color:var(--accent-1); font-weight:600}

.card-content{padding:14px}
.recent-list{display:flex;flex-direction:column;gap:12px;padding:10px}
.recent-item{display:flex;justify-content:space-between;align-items:center;padding:12px;border-radius:10px;background:#fbfdff;border:1px solid rgba(15,23,42,0.02);transition:transform .18s, background .18s}
.recent-item:hover{transform:translateY(-3px); background:#f7fbff}
.item-info h4{margin:0;font-size:1rem;color:#0f172a;font-weight:700}
.item-info p{margin:4px 0 0;color:var(--muted);font-size:0.9rem}

/* Status badges */
.status-badge{padding:6px 12px;border-radius:999px;font-size:0.78rem;font-weight:700;text-transform:uppercase}
.status-badge.Payée{background:var(--success);color:#fff}
.status-badge.EnCours{background:var(--warning);color:#fff}
.status-badge.EnRetard{background:var(--danger);color:#fff}

.quick-actions{margin-top:40px}
.actions-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
.action-card{display:flex;align-items:center;gap:12px;padding:14px;border-radius:10px;color:var(--accent-1);text-decoration:none;background:linear-gradient(90deg, rgba(91,111,240,0.08), rgba(139,92,246,0.06));border:1px solid rgba(91,111,240,0.08);box-shadow:0 6px 14px rgba(20,25,55,0.04);transition:transform .18s, box-shadow .18s}
.action-card:hover{transform:translateY(-4px); box-shadow:0 12px 30px rgba(20,25,55,0.08); background:linear-gradient(90deg, rgba(91,111,240,0.12), rgba(139,92,246,0.10));}

/* Make stat cards clickable (no visual change required) */
.stat-link{display:block;color:inherit;text-decoration:none;cursor:pointer}

/* Responsive */
@media (max-width:1000px){.stats-grid{grid-template-columns:repeat(2,1fr)}.content-grid{grid-template-columns:1fr}}
@media (max-width:640px){.stats-grid{grid-template-columns:1fr}.actions-grid{grid-template-columns:1fr}.header-content{flex-direction:column;align-items:flex-start}.dashboard-header{padding:18px}}
  </style>
{% endblock %}

{% block title %}Tableau de Bord{% endblock %}

{% block content %}
  <div class="dashboard-container">
        <!-- Header -->
        <header class="dashboard-header">
            <div class="header-left">
                <div class="logo-inline">
                    <i class="fa-solid fa-crown" aria-hidden="true"></i>
                    <span class="site-name">Abeja Kings</span>
                </div>
            </div>

            <div class="header-center">
                <h1 class="page-title">Tableau de Bord</h1>
            </div>
            <div class="header-right" style="display:flex;align-items:center;gap:12px">
                <div style="display:flex;flex-direction:column;align-items:flex-end">
                    <small style="color:var(--muted);font-size:0.85rem">Connecté en tant que</small>
                    <strong style="font-size:0.95rem">{{ request.user.get_full_name|default:request.user.username }}</strong>
                    <span style="font-size:0.8rem;color:var(--muted);">{{ request.user.userprofile.role|capfirst }}</span>
                </div>
            </div>
        </header>

        

        <!-- Statistics Cards -->
        <div class="stats-grid">
            {% if role == 'comptable' %}
                <a href="{% url 'core:factures' %}" class="stat-link">
                    <div class="stat-card">
                        <div class="stat-icon money">
                            <svg class="stat-svg" viewBox="0 0 24 24" aria-hidden="true">
                                <circle cx="12" cy="12" r="8" />
                                <path d="M11 8h2v1a2 2 0 0 1 2 2v1a2 2 0 0 1-2 2v1h-2v-1a2 2 0 0 1-2-2v-1a2 2 0 0 1 2-2V8z" fill="#fff" />
                            </svg>
                        </div>
                        <div class="stat-content">
                            {% if show_finances %}
                                <h3>{{ montant_factures_mois|floatformat:0 }} FCFA</h3>
                                <p>Factures (ce mois)</p>
                            {% else %}
                                <h3>—</h3>
                                <p>Accès restreint</p>
                            {% endif %}
                        </div>
                    </div>
                </a>

                <a href="{% url 'core:materiaux' %}" class="stat-link">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <svg class="stat-svg" viewBox="0 0 24 24" aria-hidden="true">
                                <path d="M21 8l-9-5-9 5v8l9 5 9-5V8zm-9-3.2L18.6 8 12 11.2 5.4 8 12 4.8zM4 9.9l7 3.1v6.9L4 16V9.9zM13 20v-6.9l7-3.1V16l-7 4z" />
                            </svg>
                        </div>
                        <div class="stat-content">
                            <h3>{{ total_materiaux }}</h3>
                            <p>Matériaux</p>
                            {% if materiaux_rupture > 0 %}
                            <small class="warning">{{ materiaux_rupture }} en rupture</small>
                            {% endif %}
                        </div>
                    </div>
                </a>

                <a href="{% url 'core:fournisseurs' %}" class="stat-link">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <svg class="stat-svg" viewBox="0 0 24 24" aria-hidden="true">
                                <path d="M3 6h13v7h3l3 3V6l-3-3H3v3zM6 18a2 2 0 1 0 0-4 2 2 0 0 0 0 4zm10 0a2 2 0 1 0 0-4 2 2 0 0 0 0 4z" />
                            </svg>
                        </div>
                        <div class="stat-content">
                            <h3>{{ total_fournisseurs }}</h3>
                            <p>Fournisseurs</p>
                        </div>
                    </div>
                </a>

                <a href="{% url 'core:personnel' %}" class="stat-link">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <svg class="stat-svg" viewBox="0 0 24 24" aria-hidden="true">
                                <path d="M12 2a4 4 0 1 0 0 8 4 4 0 0 0 0-8zm-6 18a6 6 0 0 1 12 0H6z" />
                            </svg>
                        </div>
                        <div class="stat-content">
                            <h3>{{ total_personnel }}</h3>
                            <p>Personnel Actif</p>
                        </div>
                    </div>
                </a>
            {% else %}
                <a href="{% url 'core:chantiers' %}?statut=en_cours" class="stat-link">
                <div class="stat-card">
                        <div class="stat-icon active">
                                                <svg class="stat-svg" viewBox="0 0 24 24" aria-hidden="true">
                                                    <path d="M4 3v18h1V13h8l3 3V3l-3 3H5V3z" />
                                                </svg>
                        </div>
                    <div class="stat-content">
                        <h3>{{ chantiers_actifs }}</h3>
                        <p>Chantiers Actifs</p>
                    </div>
                </div>
                </a>

                <a href="{% url 'core:chantiers' %}?statut=termine" class="stat-link">
                <div class="stat-card">
                        <div class="stat-icon completed">
                                                        <svg class="stat-svg" viewBox="0 0 24 24" aria-hidden="true">
                                                            <path d="M12 2a10 10 0 1 0 0 20 10 10 0 0 0 0-20zm-1 14l-4-4 1.4-1.4L11 13.2l5.6-5.6L18 9l-7 7z" />
                                                        </svg>
                        </div>
                    <div class="stat-content">
                        <h3>{{ chantiers_termines }}</h3>
                        <p>Chantiers Terminés</p>
                    </div>
                </div>
                </a>

                {# Personnel: lien vers la liste des ouvriers (filtrée) pour tous les rôles #}
                <a href="{% url 'core:personnel_role' 'ouvrier' %}" class="stat-link">
                <div class="stat-card">
                        <div class="stat-icon">
                                                        <svg class="stat-svg" viewBox="0 0 24 24" aria-hidden="true">
                                                            <path d="M12 2l3 4 3 2-2 3-4-1-4 1-2-3 3-2 3-4zM8.5 13.5l3.5 1 3.5-1 1 6H7.5l1-6z" />
                                                        </svg>
                        </div>
                    <div class="stat-content">
                        <h3>{{ total_personnel }}</h3>
                        <p>Personnel Actif</p>
                    </div>
                </div>
                </a>

                {% comment %} continue the original grid for non-comptable users {% endcomment %}

                <a href="{% url 'core:materiaux' %}" class="stat-link">
                <div class="stat-card">
                        <div class="stat-icon">
                                                        <svg class="stat-svg" viewBox="0 0 24 24" aria-hidden="true">
                                                            <path d="M21 8l-9-5-9 5v8l9 5 9-5V8zm-9-3.2L18.6 8 12 11.2 5.4 8 12 4.8zM4 9.9l7 3.1v6.9L4 16V9.9zM13 20v-6.9l7-3.1V16l-7 4z" />
                                                        </svg>
                        </div>
                    <div class="stat-content">
                        <h3>{{ total_materiaux }}</h3>
                        <p>Matériaux</p>
                        {% if materiaux_rupture > 0 %}
                        <small class="warning">{{ materiaux_rupture }} en rupture</small>
                        {% endif %}
                    </div>
                </div>
                </a>

                <a href="{% url 'core:clients' %}" class="stat-link">
                <div class="stat-card">
                        <div class="stat-icon">
                                                        <svg class="stat-svg" viewBox="0 0 24 24" aria-hidden="true">
                                                            <path d="M16 11a3 3 0 1 0 0-6 3 3 0 0 0 0 6zM8 11a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0 2c-2.7 0-8 1.3-8 4v3h16v-3c0-2.7-5.3-4-8-4zm8 0c-.3 0-.6 0-1 .1 1.4.9 2 2 2 3.9v1h6v-1c0-2.7-5.3-4-7-4z" />
                                                        </svg>
                        </div>
                    <div class="stat-content">
                        <h3>{{ total_clients }}</h3>
                        <p>Clients</p>
                    </div>
                </div>
                </a>

                {# Rendre la carte Fournisseurs cliquable pour tous les rôles. #}
                <a href="{% url 'core:fournisseurs' %}" class="stat-link">
                <div class="stat-card">
                        <div class="stat-icon">
                                                        <svg class="stat-svg" viewBox="0 0 24 24" aria-hidden="true">
                                                            <path d="M3 6h13v7h3l3 3V6l-3-3H3v3zM6 18a2 2 0 1 0 0-4 2 2 0 0 0 0 4zm10 0a2 2 0 1 0 0-4 2 2 0 0 0 0 4z" />
                                                        </svg>
                        </div>
                    <div class="stat-content">
                        <h3>{{ total_fournisseurs }}</h3>
                        <p>Fournisseurs</p>
                    </div>
                </div>
                </a>

                {% if role != 'chef' %}
                <a href="{% url 'core:factures' %}" class="stat-link">
                <div class="stat-card">
                    <div class="stat-icon money">
                                                <svg class="stat-svg" viewBox="0 0 24 24" aria-hidden="true">
                                                    <circle cx="12" cy="12" r="8" />
                                                    <path d="M11 8h2v1a2 2 0 0 1 2 2v1a2 2 0 0 1-2 2v1h-2v-1a2 2 0 0 1-2-2v-1a2 2 0 0 1 2-2V8z" fill="#fff" />
                                                </svg>
                    </div>
                    <div class="stat-content">
                        {% if show_finances %}
                            <h3>{{ montant_factures_mois|floatformat:0 }} FCFA</h3>
                            <p>Factures (ce mois)</p>
                        {% else %}
                            <h3>—</h3>
                            <p>Accès restreint</p>
                        {% endif %}
                    </div>
                </div>
                </a>
                {% endif %}

                {# Rapports stat card #}
                <a href="{% url 'core:rapports' %}" class="stat-link">
                <div class="stat-card">
                        <div class="stat-icon">
                                                        <svg class="stat-svg" viewBox="0 0 24 24" aria-hidden="true">
                                                            <rect x="3" y="10" width="3" height="11" />
                                                            <rect x="9" y="6" width="3" height="15" />
                                                            <rect x="15" y="3" width="3" height="18" />
                                                        </svg>
                        </div>
                    <div class="stat-content">
                        <h3>{{ rapports_user_count|default:rapports_count }}</h3>
                        <p>Rapports</p>
                    </div>
                </div>
                </a>
            {% endif %}
        </div>

        <!-- Main Content -->
        <div class="dashboard-content">
            <div class="content-grid">
                {% if role == 'comptable' %}
                <!-- Factures en attente (pour comptable) -->
                <div class="content-card">
                    <div class="card-header">
                        <h2><i class="fa-solid fa-exclamation-circle" aria-hidden="true"></i> Factures en attente</h2>
                        <div>
                            <a href="{% url 'core:factures' %}" class="btn-link" title="Voir tout">Voir tout</a>
                        </div>
                    </div>
                    <div class="card-content">
                        {% if unpaid_factures %}
                        <div class="recent-list">
                            {% for facture in unpaid_factures %}
                            <div class="recent-item">
                                <div class="item-info">
                                    <h4>Facture #{{ facture.numero }}</h4>
                                    <p>{{ facture.client.nom }} • Reste: {{ facture.reste_a_payer|floatformat:0 }} FCFA</p>
                                </div>
                                <div class="item-actions">
                                    <a href="{% url 'core:facture_detail' facture.pk %}" class="btn-sm" title="Ouvrir">
                                        <i class="fa-solid fa-eye" aria-hidden="true"></i>
                                    </a>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        {% else %}
                        <div class="empty-state">
                            <svg class="icon-invoice" width="48" height="48" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                                <path d="M4 2h9l6 6v12a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V3a1 1 0 0 1 1-1z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M13 2v7h7" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M8 13h8" stroke="currentColor" stroke-width="1.2" stroke-linecap="round"/>
                                <path d="M8 16h8" stroke="currentColor" stroke-width="1.2" stroke-linecap="round"/>
                                <path d="M8 19h5" stroke="currentColor" stroke-width="1.2" stroke-linecap="round"/>
                            </svg>
                            <p>Aucune facture en attente</p>
                        </div>
                        {% endif %}
                    </div>
                </div>
                {% else %}
                <!-- Recent Projects -->
                <div class="content-card">
                    <div class="card-header">
                        <h2><i class="fa-solid fa-clock" aria-hidden="true"></i> Chantiers Récents</h2>
                        <div>
                            <a href="{% url 'core:chantiers' %}" class="btn-link" title="Voir tout">Voir tout</a>
                            <a href="{% url 'core:chantiers' %}" class="btn-link" title="Gérer les chantiers">Gérer</a>
                        </div>
                    </div>
                    <div class="card-content">
                        {% if chantiers_recents %}
                        <div class="recent-list">
                            {% for chantier in chantiers_recents %}
                            <div class="recent-item">
                                <div class="item-info">
                                    <h4>{{ chantier.nom }}</h4>
                                    <p>{{ chantier.client.nom }} • {{ chantier.get_statut_display }}</p>
                                </div>
                                <div class="item-actions">
                                    {# Edit link if chantier_update exists #}
                                    <a href="{% url 'core:chantier_update' chantier.pk %}" class="btn-sm" title="Modifier">
                                        <i class="fa-solid fa-edit" aria-hidden="true"></i>
                                    </a>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        {% else %}
                        <div class="empty-state">
                            <i class="fa-solid fa-building" aria-hidden="true"></i>
                            <p>Aucun chantier récent</p>
                        </div>
                        {% endif %}
                    </div>
                </div>
                {% endif %}

                <!-- Factures Récentes supprimées pour rôle chef/visibilité générale -->
                {% if role == 'comptable' %}
                <!-- Fournisseurs Récents (pour comptable) -->
                <div class="content-card">
                    <div class="card-header">
                        <h2><i class="fa-solid fa-truck" aria-hidden="true"></i> Fournisseurs Récents</h2>
                        <div>
                            <a href="{% url 'core:fournisseurs' %}" class="btn-link" title="Voir tout">Voir tout</a>
                            <a href="{% url 'core:fournisseurs' %}" class="btn-link" title="Gérer">Gérer</a>
                        </div>
                    </div>
                    <div class="card-content">
                        {% if fournisseurs_recents %}
                        <div class="recent-list">
                            {% for f in fournisseurs_recents %}
                            <div class="recent-item">
                                <div class="item-info">
                                    <h4>{{ f.nom }}</h4>
                                    <p>{{ f.ville|default:'-' }} • {{ f.telephone|default:'-' }}</p>
                                </div>
                                <div class="item-actions">
                                    <a href="{% url 'core:fournisseur_update' f.pk %}" class="btn-sm" title="Modifier">
                                        <i class="fa-solid fa-edit" aria-hidden="true"></i>
                                    </a>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        {% else %}
                        <div class="empty-state">
                            <i class="fa-solid fa-truck" aria-hidden="true"></i>
                            <p>Aucun fournisseur récent</p>
                        </div>
                        {% endif %}
                    </div>
                </div>
                {% else %}
                        <!-- Rapports Récents -->
                        <div class="content-card">
                            <div class="card-header">
                                <h2><i class="fa-solid fa-file-alt" aria-hidden="true"></i> Rapports Récents</h2>
                                <div>
                                    <a href="{% url 'core:rapports' %}" class="btn-link" title="Voir tout">Voir tout</a>
                                    <a href="{% url 'core:rapports' %}" class="btn-link" title="Gérer les rapports">Gérer</a>
                                </div>
                            </div>
                            <div class="card-content">
                                {% if rapports_recents %}
                                <div class="recent-list">
                                    {% for rapport in rapports_recents %}
                                    <div class="recent-item">
                                        <div class="item-info">
                                            <h4>{{ rapport.titre }}</h4>
                                            <p>{{ rapport.auteur.get_full_name|default:rapport.auteur.username }} • {{ rapport.date }}</p>
                                        </div>
                                        <div class="item-actions">
                                            {# Link to rapports list (no per-rapport edit page) #}
                                            <a href="{% url 'core:rapports' %}" class="btn-sm" title="Voir">
                                                <i class="fa-solid fa-eye" aria-hidden="true"></i>
                                            </a>
                                        </div>
                                    </div>
                                    {% endfor %}
                                </div>
                                {% else %}
                                <div class="empty-state">
                                    <i class="fa-solid fa-file-alt" aria-hidden="true"></i>
                                    <p>Aucun rapport récent</p>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                {% endif %}
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="quick-actions">
            <h2>Actions Rapides</h2>
            <div class="actions-grid">
                {% if role == 'admin' or role == 'directeur' or role == 'chef' %}
                <a href="{% url 'core:chantier_create' %}" class="action-card">
                    <i class="fas fa-plus-circle"></i>
                    <span>Nouveau Chantier</span>
                </a>
                <a href="{% url 'core:client_new' %}" class="action-card">
                    <i class="fas fa-user-plus"></i>
                    <span>Nouveau Client</span>
                </a>
                <a href="{% url 'core:materiaux' %}" class="action-card">
                    <i class="fas fa-boxes"></i>
                    <span>Gérer Matériaux</span>
                </a>
                <a href="{% url 'core:fournisseurs' %}" class="action-card">
                    <i class="fas fa-truck-moving"></i>
                    <span>Gérer Fournisseurs</span>
                </a>
                {% if role != 'chef' %}
                <a href="{% url 'core:personnel' %}" class="action-card">
                    <i class="fas fa-user-tie"></i>
                    <span>Gérer Personnel</span>
                </a>
                {% endif %}
                {% endif %}

                {% if role == 'admin' or role == 'comptable' %}
                <a href="{% url 'core:factures' %}" class="action-card">
                    <i class="fas fa-file-invoice-dollar"></i>
                    <span>Gérer Factures</span>
                </a>
                {% endif %}
            </div>
        </div>
    </div>
{% endblock %}

{% block extra_js %}{% endblock %}